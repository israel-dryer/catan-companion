import{a as I}from"./chunk-GIDP7GDQ.js";import{a as G}from"./chunk-RW7D7ZYR.js";import{a as x}from"./chunk-Z3GWI56J.js";import{a as S,b as u}from"./chunk-4HHYV5DL.js";import{a as f}from"./chunk-LQVFMVUB.js";import{a as l}from"./chunk-OI36OCLG.js";import{a as b}from"./chunk-OGSRTT4J.js";import{Pa as p,u as d,x as o}from"./chunk-PV5YSWZ3.js";import{h as n}from"./chunk-HCV7W5KS.js";var y=(()=>{let i=class i{constructor(){this.diceAudioSource="/assets/sounds/dice-sound.mp3",this.robberAudioSource="/assets/sounds/evil-laugh.mp3",this.settingService=o(u),this.diceRollSoundEnabled=!1,this.robberSoundEnabled=!1,this.speechEnabled=!1,this.speechAvailable=!1,this.diceSound=new Audio(this.diceAudioSource),this.diceSound.load(),this.robberSound=new Audio(this.robberAudioSource),this.robberSound.load(),this.settingsSub=l(()=>this.settingService.getAll()).subscribe(e=>{var t,a,c,h,m,v;this.diceRollSoundEnabled=(t=e.find(s=>s.id==="rollingDiceSoundEnabled"))==null?void 0:t.value,this.robberSoundEnabled=(a=e.find(s=>s.id==="robberLaughSoundEnabled"))==null?void 0:a.value,this.speechEnabled=(c=e.find(s=>s.id=="speechEnabled"))==null?void 0:c.value,this.speechAvailable=(h=e.find(s=>s.id==="speechAvailable"))==null?void 0:h.value,this.speechVoice=(v=(m=e.find(s=>s.id==="speechVoice"))==null?void 0:m.value)==null?void 0:v.index})}ngOnDestroy(){this.settingsSub.unsubscribe()}playDiceSound(){return this.diceSound.play()}playRobberSound(){return this.robberSound.play()}speakResult(e){var t;this.speechEnabled&&S.speak({text:e.toString(),rate:.7,voice:(t=this.speechVoice)!=null?t:0,lang:navigator.language}).then().catch(a=>console.warn(a))}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();var g=b("Haptics",{web:()=>import("./chunk-47MUIJK2.js").then(r=>new r.HapticsWeb)});var N=(()=>{let i=class i{constructor(){this.gameService=o(f),this.audioService=o(y),this.currentService=o(I),this.settingsService=o(u),this.router=o(p),this.alertController=o(G),this.hapticsEnabled=!1,this.showPlaceSettlementsAlert=e=>n(this,null,function*(){let t=e.turnIndex;return(yield this.alertController.create({header:"Place Settlements",message:e.roster[t].toUpperCase()+" is first. Click START when all players have placed their settlements",buttons:["Start"]})).present()}),this.hapticsEnabledSub=l(()=>this.settingsService.get("hapticsEnabled")).subscribe(e=>{var t;return this.hapticsEnabled=(t=e==null?void 0:e.value)!=null?t:!1}),this.activeGameSub=l(()=>this.currentService.getCurrentItem("activeGameId")).subscribe(e=>n(this,null,function*(){this.activeGameId=e==null?void 0:e.value,this.activeGameId&&(this.activeGame=yield this.gameService.selectGame(this.activeGameId))}))}ngOnDestroy(){this.activeGameSub.unsubscribe(),this.hapticsEnabledSub.unsubscribe()}get prevPlayer(){if(this.activeGame){let e=this.prevTurnIndex();return this.activeGame.roster[e]}}get currPlayer(){return this.activeGame?this.activeGame.roster[this.activeGame.turnIndex]:""}startGame(e){return n(this,null,function*(){yield this.gameService.insertGame(e),this.currentService.setCurrentItem("activeGameId",e.id),yield this.showPlaceSettlementsAlert(e),yield this.router.navigate(["play"])})}endActiveGame(e){return n(this,null,function*(){this.activeGame&&e&&(this.activeGame.winner=e,yield this.gameService.updateGame(this.activeGame)),this.currentService.deleteCurrentItem("activeGameId")})}roll(){return n(this,null,function*(){var h;this.hapticsEnabled&&(yield g.impact({style:x.Heavy}));let e=Math.floor(Math.random()*6)+1,t=Math.floor(Math.random()*6)+1,a=(h=this.activeGame)!=null&&h.citiesAndKnights?this.getCitiesAndKnightsActivity():void 0,c=e+t;return yield this.audioService.playDiceSound(),this.activeGame&&(this.activeGame.rolls.push({id:Math.random(),dice1:e,dice2:t,total:c,action:a,player:this.currPlayer,timestamp:Date.now()}),this.activeGame.turnIndex=this.nextTurnIndex(),this.gameService.updateGame(this.activeGame),c===7&&this.audioService.robberSoundEnabled?setTimeout(()=>n(this,null,function*(){yield this.audioService.playRobberSound()}),500):setTimeout(()=>n(this,null,function*(){this.audioService.speakResult(c)}),500)),{dice1:e,dice2:t,total:c}})}getCitiesAndKnightsActivity(){let e=["BAR","GLD","BAR","BLU","BAR","GRN"],t=Math.floor(Math.random()*e.length);return e[t]}undoLastRoll(){return n(this,null,function*(){var e;this.activeGame&&((e=this.activeGame)!=null&&e.rolls.length)&&(this.activeGame.rolls.pop(),this.activeGame.turnIndex=this.prevTurnIndex(),yield this.gameService.updateGame(this.activeGame))})}nextTurnIndex(){if(this.activeGame){let e=this.activeGame.roster.length-1,a=this.activeGame.turnIndex+1;return a<=e?a:0}return 0}prevTurnIndex(){if(this.activeGame){let e=this.activeGame.turnIndex,t=this.activeGame.turnIndex-1;return t>=0?t:this.activeGame.roster.length-1}return 0}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();export{N as a};
